<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📝 P2P Notes - Bloc Colaborativo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <h1>📝 P2P Notes</h1>
                <p class="subtitle">Sistema de notas colaborativo descentralizado</p>
            </div>
            
            <div class="status-bar">
                <div class="status-item">
                    <span class="status-dot" id="connectionStatus"></span>
                    <span class="status-text">Estado</span>
                </div>
                <div class="status-item">
                    <span class="label">ID:</span>
                    <code id="nodeId">-</code>
                </div>
                <div class="status-item">
                    <span class="label">📝 Notas:</span>
                    <strong id="noteCount">0</strong>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Editor de Notas (Modal) -->
            <div class="editor-overlay" id="noteEditor" style="display: none;">
                <div class="editor-modal">
                    <div class="editor-header">
                        <h2>✏️ Editor de Nota</h2>
                        <button class="btn-close" id="closeEditor" title="Cerrar">✕</button>
                    </div>
                    <div class="editor-body">
                        <input 
                            type="text" 
                            id="noteTitle" 
                            class="input-field"
                            placeholder="📌 Título de la nota..." 
                            maxlength="100"
                        />
                        <textarea 
                            id="noteContent" 
                            class="textarea-field"
                            placeholder="✍️ Escribe aquí el contenido de tu nota..." 
                            rows="8"
                        ></textarea>
                    </div>
                    <div class="editor-footer">
                        <button id="saveNote" class="btn btn-primary">
                            💾 Guardar
                        </button>
                        <button id="cancelEdit" class="btn btn-secondary">
                            ❌ Cancelar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Botón Crear Nota -->
            <div class="actions-bar">
                <button id="createNote" class="btn btn-create">
                    ➕ Nueva Nota
                </button>
            </div>

            <!-- Lista de Notas -->
            <section class="notes-section">
                <div class="section-header">
                    <h2>📚 Mis Notas</h2>
                </div>
                <div id="notesList" class="notes-grid">
                    <!-- Las notas se renderizan aquí dinámicamente -->
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer>
            <p>💻 <strong>P2P Notes</strong> - Tecnología WebRTC + Socket.IO</p>
            <p class="footer-info">Sistema descentralizado | Sincronización en tiempo real</p>
        </footer>
    </div>

    <!-- Botón ver Peers -->
    <button class="peers-fab" onclick="app.showPeersPanel()" title="Ver Peers Conectados" aria-label="Ver Peers">
        👥
    </button>

    <!-- Panel de Estrategias -->
    <button class="strategy-fab" onclick="app.showStrategyPanel()" title="Configurar Estrategias" aria-label="Configurar Estrategias">
        ⚙️
    </button>

    <!-- Contenedor de Notificaciones Toast -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Panel de Peers Conectados -->
    <div class="peers-panel" id="peersPanel" style="display: none;">
        <div class="peers-content">
            <div class="peers-header">
                <h3>👥 Peers Conectados</h3>
                <button class="btn-close-panel" onclick="app.showPeersPanel()">✕</button>
            </div>
            <div class="peers-body">
                <div class="peers-stats">
                    <div class="peer-stat-item">
                        <span class="stat-label">Total Peers:</span>
                        <span class="stat-value" id="totalPeers">0</span>
                    </div>
                    <div class="peer-stat-item">
                        <span class="stat-label">Conectados:</span>
                        <span class="stat-value connected" id="connectedPeers">0</span>
                    </div>
                    <div class="peer-stat-item">
                        <span class="stat-label">Desconectados:</span>
                        <span class="stat-value disconnected" id="disconnectedPeers">0</span>
                    </div>
                </div>
                <div id="peersListContainer" class="peers-list-container">
                    <p class="no-peers">No hay peers conectados aún.</p>
                </div>
            </div>
            <div class="peers-footer">
                <button class="btn btn-secondary" onclick="app.refreshPeersList()">🔄 Actualizar</button>
                <button class="btn btn-info" onclick="app.testSyncWithPeers()">🔄 Probar Sincronización</button>
            </div>
        </div>
    </div>

    <!-- Notificación del Patrón Strategy -->
    <div class="strategy-notification" id="strategyNotification" style="display: none;">
        <div class="notification-content">
            <div class="notification-icon" id="notificationIcon">⚙️</div>
            <div class="notification-text">
                <div class="notification-title" id="notificationTitle">Estrategia Cambiada</div>
                <div class="notification-description" id="notificationDescription"></div>
            </div>
            <button class="notification-close" onclick="app.closeNotification()">✕</button>
        </div>
    </div>

    <div class="strategy-panel" id="strategyPanel" style="display: none;">
        <div class="strategy-content">
            <div class="strategy-header">
                <h3>🎯 Patrón Strategy</h3>
                <button class="btn-close-panel" onclick="app.showStrategyPanel()">✕</button>
            </div>
            
            <div class="strategy-section">
                <h4>🔄 Resolución de Conflictos</h4>
                <p class="strategy-desc">Actual: <strong id="currentConflictStrategy">Last-Write-Wins</strong></p>
                <p class="strategy-info" id="conflictStrategyInfo">La última modificación prevalece en caso de conflicto.</p>
                <select id="conflictStrategySelect" onchange="app.setConflictStrategy(this.value)">
                    <option value="last-write-wins">Last-Write-Wins (Último escribe)</option>
                    <option value="first-write-wins">First-Write-Wins (Primero escribe)</option>
                    <option value="version-based">Version-Based (Por versión)</option>
                    <option value="content-merge">Content-Merge (Fusionar)</option>
                    <option value="author-priority">Author-Priority (Prioridad autor)</option>
                </select>
            </div>

            <div class="strategy-section">
                <h4>💾 Almacenamiento</h4>
                <p class="strategy-desc">Actual: <strong id="currentStorageStrategy">LocalStorage</strong></p>
                <p class="strategy-info" id="storageStrategyInfo">Datos persistentes en el navegador.</p>
                <select id="storageStrategySelect" onchange="app.setStorageStrategy(this.value)">
                    <option value="local-storage">LocalStorage (Persistente)</option>
                    <option value="session-storage">SessionStorage (Temporal)</option>
                    <option value="in-memory">InMemory (Solo RAM)</option>
                    <option value="indexed-db">IndexedDB (Gran capacidad)</option>
                </select>
            </div>

            <div class="strategy-section">
                <h4>📡 Broadcasting</h4>
                <p class="strategy-desc">Actual: <strong id="currentBroadcastStrategy">Broadcast-All</strong></p>
                <p class="strategy-info" id="broadcastStrategyInfo">Envío de mensajes a todos los nodos conectados.</p>
                <select id="broadcastStrategySelect" onchange="app.setBroadcastStrategy(this.value)">
                    <option value="broadcast-all">Broadcast-All (Todos)</option>
                    <option value="selective">Selective (Selectivo)</option>
                    <option value="gossip">Gossip Protocol (Epidémico)</option>
                    <option value="priority">Priority-Based (Prioridad)</option>
                    <option value="batch">Batch (Por lotes)</option>
                </select>
            </div>

            <div class="strategy-actions">
                <button class="btn btn-info" onclick="app.showStorageInfo()">
                    📊 Ver Estadísticas
                </button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <!-- Cargar estrategias primero -->
    <script src="strategies/conflictResolutionStrategies.js"></script>
    <script src="strategies/storageStrategies.js"></script>
    <script src="strategies/broadcastStrategies.js"></script>
    <!-- Luego la aplicación principal -->
    <script src="app.js"></script>
</body>
</html>
